5.Kubernetes集群搭建-command

yum remove kubeadm  kubectl  kubelet  -y 

yum install kubeadm-1.15.1-0.x86_64 kubelet-1.15.1-0.x86_64 kubectl-1.15.1-0.x86_64 -y

安装镜像

docker pull mirrorgooglecontainers/kube-apiserver:v1.15.1

docker pull mirrorgooglecontainers/kube-controller-manager:v1.15.1
 docker pull mirrorgooglecontainers/kube-scheduler:v1.15.1
 docker pull mirrorgooglecontainers/kube-proxy:v1.15.1
docker pull mirrorgooglecontainers/pause:3.1
 docker pull mirrorgooglecontainers/etcd:3.3.10
 docker pull coredns/coredns:1.3.1
docker pull registry.cn-shenzhen.aliyuncs.com/cp_m/flannel:v0.10.0-amd64

取别名

docker tag mirrorgooglecontainers/kube-apiserver:v1.15.1 bingyuantin/kube-apiserver:v1.15.1 

docker tag mirrorgooglecontainers/kube-controller-manager:v1.15.1 bingyuantin/kube-controller-manager:v1.15.1 

docker tag mirrorgooglecontainers/kube-scheduler:v1.15.1 bingyuantin/kube-scheduler:v1.15.1 

docker tag mirrorgooglecontainers/kube-proxy:v1.15.1 bingyuantin/kube-proxy:v1.15.1 

docker tag mirrorgooglecontainers/pause:3.1 bingyuantin/pause:3.1 

docker tag mirrorgooglecontainers/etcd:3.3.10 bingyuantin/etcd:3.3.10 

docker tag coredns/coredns:1.3.1 bingyuantin/coredns:1.3.1 

docker tag registry.cn-shenzhen.aliyuncs.com/cp_m/flannel:v0.10.0-amd64 bingyuantin/flannel:v0.10.0-amd64

删除镜像

docker rmi mirrorgooglecontainers/kube-apiserver:v1.15.1 

docker rmi mirrorgooglecontainers/kube-controller-manager:v1.15.1 

docker rmi mirrorgooglecontainers/kube-scheduler:v1.15.1 

docker rmi mirrorgooglecontainers/kube-proxy:v1.15.1 

docker rmi mirrorgooglecontainers/pause:3.1 

docker rmi mirrorgooglecontainers/etcd:3.3.10 

docker rmi coredns/coredns:1.3.1 

docker rmi registry.cn-shenzhen.aliyuncs.com/cp_m/flannel:v0.10.0-amd64

推送到自己git hub

docker push bingyuantin/kube-apiserver:v1.15.1 

docker push bingyuantin/kube-controller-manager:v1.15.1 

docker push bingyuantin/kube-scheduler:v1.15.1 

docker push bingyuantin/kube-proxy:v1.15.1 

docker push bingyuantin/pause:3.1 

docker push bingyuantin/etcd:3.3.10 

docker push bingyuantin/coredns:1.3.1 

docker push bingyuantin/flannel:v0.10.0-amd64

master节点初始化



swapoff  -a

```
sed` `-i ``'/ swap / s/^\(.*\)$/#\1/g'` `/etc/fstab
```

2cpu

(1) 初始化

kubeadm init --kubernetes-version=v1.15.1 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --ignore-preflight-errors=Swap

（2）设置`.kube/config`

mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

(3) 保存输出中`kubeadm join`行命令, 在`node`节点会执行

kubeadm join 192.168.168.131:6443 --token 3xl2g9.88wtub88mwvoqpvf \
    --discovery-token-ca-cert-hash sha256:49a56b1bd3e3fa1cb63f146db21ffc20f9dc33e1134e0882731d91278bd0dcb2

(4) 配置 kubectl

echo "export KUBECONFIG=/etc/kubernetes/admin.conf" >> /etc/profile 

source /etc/profile 

echo $KUBECONFIG

(5) 安装Pod网络

安装 Pod网络是 Pod之间进行通信的必要条件，k8s支持众多网络方案，这里我们依然选用经典的`flannel`方案

a.在任意位置新建文件 `kube-flannel.yaml`, 文件内容